<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BSO Projekt â€“ Symulator Kodowania Gold</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10" crossorigin="anonymous"></script>
</head>
<body>
    <div class="main-title">BSO Projekt - Symulator Kodowania Gold</div>
    <div class="subtitle">Konfiguracja ModuÅ‚Ã³w</div>    <form id="sim-form">
        <div class="modules-grid">
            <div class="card">
                <div class="card-header"><span class="icon">ðŸ“‹</span>Dane WejÅ›ciowe</div>
                <div class="card-config">
                    <label>Tekst do zakodowania:
                        <input type="text" name="seqText" placeholder="np. hello world">
                    </label>
                    <label>DÅ‚ugoÅ›Ä‡ losowej sekwencji:
                        <input type="number" name="seqLength" value="64" min="1" max="256">
                    </label>
                </div>
                <div class="card-result" id="result-generator">(wynik pojawi siÄ™ po uruchomieniu)</div>
            </div>
            <div class="card">
                <div class="card-header"><span class="icon">ðŸ”‘</span>Konfiguracja Kodu Gold</div>
                <div class="card-config">
                    <label>DÅ‚ugoÅ›Ä‡ rejestru (n):
                        <input type="number" name="goldN" value="10" min="2" max="16">
                    </label>                    <label>LFSR1 Taps (przecinek):
                        <input type="text" name="goldTaps1" value="0,3">
                    </label>
                    <label>LFSR2 Taps (przecinek):
                        <input type="text" name="goldTaps2" value="0,2,3,8">
                    </label>
                </div>
                <div class="card-result" id="result-encoder">(wynik pojawi siÄ™ po uruchomieniu)</div>
            </div>
            <div class="card">
                <div class="card-header">
                    <input type="checkbox" name="errorEnabled" checked> <span class="icon">âš¡</span>Dodawanie BÅ‚Ä™dÃ³w
                </div>
                <div class="card-config">
                    <label>Typ bÅ‚Ä™du:
                        <select name="errorType">
                            <option value="random">Losowy</option>
                            <option value="burst">Seria (burst)</option>
                        </select>
                    </label>
                    <label>PrawdopodobieÅ„stwo [%]:
                        <input type="number" name="errorRate" value="5" min="0" max="100">
                    </label>
                </div>
                <div class="card-result" id="result-error">(wynik pojawi siÄ™ po uruchomieniu)</div>
            </div>
            <div class="card">
                <div class="card-header">
                    <input type="checkbox" name="decoderEnabled" checked> 
                    <span class="icon">ðŸ”’</span>Dekoder
                </div>
                <div class="card-config">
                    <label>Typ dekodera:
                        <select name="decoderType">
                            <option value="xor">Prosty XOR</option>
                        </select>
                    </label>
                </div>
                <div class="card-result" id="result-decoder">(wynik pojawi siÄ™ po uruchomieniu)</div>
            </div>
            
            <div class="card">
                <div class="card-header">
                    <input type="checkbox" name="berEnabled" checked> 
                    <span class="icon">ðŸ“Š</span>Analiza BER
                </div>
                <div class="card-config">
                    <span>PorÃ³wnanie oryginaÅ‚u i wyjÅ›cia dekodera</span>
                </div>
                <div class="card-result" id="result-ber">(wynik pojawi siÄ™ po uruchomieniu)</div>
            </div>
        </div>
        <div class="actions">
            <button type="button" class="btn-main" onclick="runSimulation()">Uruchom SymulacjÄ™</button>
            <button type="reset" class="btn-reset">Reset Konfiguracji</button>
        </div>
    </form>
      <script>
    async function runSimulation() {
        const form = document.getElementById('sim-form');
        const formData = new FormData(form);
        
        // Disable button during simulation
        const btn = document.querySelector('.btn-main');
        btn.disabled = true;
        btn.textContent = 'Trwa symulacja...';
        
        // Clear all results
        document.getElementById('result-generator').innerHTML = 'Generowanie...';
        document.getElementById('result-encoder').innerHTML = 'Kodowanie...';
        document.getElementById('result-error').innerHTML = 'Dodawanie bÅ‚Ä™dÃ³w...';
        document.getElementById('result-decoder').innerHTML = 'Dekodowanie...';
        document.getElementById('result-ber').innerHTML = 'Analiza BER...';
        
        try {
            // First, run the complete simulation to populate global results
            const simulateResponse = await fetch('/simulate', {
                method: 'POST',
                body: formData
            });
            
            if (!simulateResponse.ok) {
                throw new Error('Simulation failed');
            }
            
            // Now call each module handler to get their specific results
            
            // 1. Generator
            const generatorResponse = await fetch('/generator');
            if (generatorResponse.ok) {
                const generatorHtml = await generatorResponse.text();
                document.getElementById('result-generator').innerHTML = generatorHtml;
            }
            
            // 2. Encoder
            const encoderResponse = await fetch('/encoder');
            if (encoderResponse.ok) {
                const encoderHtml = await encoderResponse.text();
                document.getElementById('result-encoder').innerHTML = encoderHtml;
            }
            
            // 3. Error (if enabled)
            if (formData.get('errorEnabled') === 'on') {
                const errorResponse = await fetch('/error');
                if (errorResponse.ok) {
                    const errorHtml = await errorResponse.text();
                    document.getElementById('result-error').innerHTML = errorHtml;
                }
            } else {
                document.getElementById('result-error').innerHTML = '<div class="result-item">ModuÅ‚ wyÅ‚Ä…czony</div>';
            }
            
            // 4. Decoder (if enabled)
            if (formData.get('decoderEnabled') === 'on') {
                const decoderResponse = await fetch('/decoder');
                if (decoderResponse.ok) {
                    const decoderHtml = await decoderResponse.text();
                    document.getElementById('result-decoder').innerHTML = decoderHtml;
                }
            } else {
                document.getElementById('result-decoder').innerHTML = '<div class="result-item">ModuÅ‚ wyÅ‚Ä…czony</div>';
            }
            
            // 5. BER (if enabled)
            if (formData.get('berEnabled') === 'on') {
                const berResponse = await fetch('/ber');
                if (berResponse.ok) {
                    const berHtml = await berResponse.text();
                    document.getElementById('result-ber').innerHTML = berHtml;
                }
            } else {
                document.getElementById('result-ber').innerHTML = '<div class="result-item">ModuÅ‚ wyÅ‚Ä…czony</div>';
            }
            
        } catch (error) {
            console.error('Error:', error);
            alert('BÅ‚Ä…d podczas symulacji: ' + error.message);
        } finally {
            // Re-enable button
            btn.disabled = false;
            btn.textContent = 'Uruchom SymulacjÄ™';
        }
    }
    </script>
    <div id="results"></div>
</body>
</html>
